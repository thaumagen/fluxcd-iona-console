# see the README for why we patch in the patches
apiVersion: kustomize.toolkit.fluxcd.io/v1beta2
kind: Kustomization
metadata:
  # metadata is used to match the target to patch
  namespace: iona-console
  name: iona-app
spec:
  - target:
      kind: IngressRoute
      name: iona-app
    patch: |-
           - op: replace
             path: /spec/routes/0/match
             value: Host(`iona.thaumagen.io`) && PathPrefix(`/stage/console/`)
           - op: replace
             path: /spec/tls/secretName
             value: wild-iona-thaumagen-io
  - target:
      kind: Middleware
      name: strip-ingressroute-prefix
    patch: |-
           - op: replace
             path: /spec/stripPrefix/prefixes/0
             value: /stage/console/
